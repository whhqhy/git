<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>gradle学习心得，记录 | 我的哲思</title><link rel="stylesheet" type="text/css" href="//fonts.neworld.org/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">gradle学习心得，记录</h1><a id="logo" href="/.">我的哲思</a><p class="description">耐得住寂寞，守得了花开。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Android"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">gradle学习心得，记录</h1><div class="post-meta"><a href="/2016/07/04/gradle-学习心得/#comments" class="comment-count"></a><p><span class="date">Jul 04, 2016</span><span><a href="/categories/Gradle/" class="category">Gradle</a></span></p></div><div class="post-content"><p>hook ,apply from<br><a id="more"></a></p>
<hr>
<h1 id="&#x4E00;&#x3001;gradle&#x5DE5;&#x4F5C;&#x6D41;"><a href="#&#x4E00;&#x3001;gradle&#x5DE5;&#x4F5C;&#x6D41;" class="headerlink" title="&#x4E00;&#x3001;gradle&#x5DE5;&#x4F5C;&#x6D41;"></a>&#x4E00;&#x3001;gradle&#x5DE5;&#x4F5C;&#x6D41;</h1><p>&#x5177;&#x4F53;&#x63CF;&#x8FF0;&#x6709;&#x7A7A;&#x518D;&#x5199;</p>
<p><img src="/2016/07/04/gradle-&#x5B66;&#x4E60;&#x5FC3;&#x5F97;/gradle work push.png" alt="gradle&#x5DE5;&#x4F5C;&#x6D41;"></p>
<h2 id="&#x8BFB;&#x53D6;manifest&#x4E2D;versionName"><a href="#&#x8BFB;&#x53D6;manifest&#x4E2D;versionName" class="headerlink" title="&#x8BFB;&#x53D6;manifest&#x4E2D;versionName"></a>&#x8BFB;&#x53D6;manifest&#x4E2D;versionName</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> getVersionNameAdvanced(Project project){</div><div class="line">    <span class="keyword">def</span> xmlFile = project.file(<span class="string">&quot;AndroidManifest.xml&quot;</span>)</div><div class="line">    <span class="keyword">def</span> rootManifest = <span class="keyword">new</span> XmlSlurper().parse(xmlFile)</div><div class="line">    <span class="keyword">return</span> rootManifest[<span class="string">&apos;@android:versionName&apos;</span>]</div><div class="line">}</div></pre></td></tr></table></figure>
<h2 id="&#x4E3A;&#x6240;&#x6709;&#x5B50;&#x5DE5;&#x7A0B;&#x6DFB;&#x52A0;&#x516C;&#x5171;&#x65B9;&#x6CD5;"><a href="#&#x4E3A;&#x6240;&#x6709;&#x5B50;&#x5DE5;&#x7A0B;&#x6DFB;&#x52A0;&#x516C;&#x5171;&#x65B9;&#x6CD5;" class="headerlink" title="&#x4E3A;&#x6240;&#x6709;&#x5B50;&#x5DE5;&#x7A0B;&#x6DFB;&#x52A0;&#x516C;&#x5171;&#x65B9;&#x6CD5;"></a>&#x4E3A;&#x6240;&#x6709;&#x5B50;&#x5DE5;&#x7A0B;&#x6DFB;&#x52A0;&#x516C;&#x5171;&#x65B9;&#x6CD5;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">subprojects{</div><div class="line">    logger.log(LogLevel.INFO,&apos;Config for &apos;+project.name)</div><div class="line">    apply from: rootProject.getRootDir().getAbsolutePath()+&apos;/utils.gradle&apos;</div><div class="line">}</div></pre></td></tr></table></figure>
<h2 id="&#x5C06;&#x4F9D;&#x8D56;&#x6269;&#x5C55;&#x548C;&#x53C2;&#x6570;&#x62BD;&#x79BB;&#x5230;&#x65B0;&#x7684;&#x811A;&#x672C;"><a href="#&#x5C06;&#x4F9D;&#x8D56;&#x6269;&#x5C55;&#x548C;&#x53C2;&#x6570;&#x62BD;&#x79BB;&#x5230;&#x65B0;&#x7684;&#x811A;&#x672C;" class="headerlink" title="&#x5C06;&#x4F9D;&#x8D56;&#x6269;&#x5C55;&#x548C;&#x53C2;&#x6570;&#x62BD;&#x79BB;&#x5230;&#x65B0;&#x7684;&#x811A;&#x672C;"></a>&#x5C06;&#x4F9D;&#x8D56;&#x6269;&#x5C55;&#x548C;&#x53C2;&#x6570;&#x62BD;&#x79BB;&#x5230;&#x65B0;&#x7684;&#x811A;&#x672C;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">config.gradle</div><div class="line"></div><div class="line">apply plugin: &apos;com.android.application&apos;</div><div class="line"></div><div class="line">def addExtendsDependencies(){</div><div class="line">    dependencies {</div><div class="line">        compile(name: &apos;CommonLib-1.0-release&apos;, ext: &apos;aar&apos;)</div><div class="line">        compile(name: &apos;Drawer-1.0-release&apos;, ext: &apos;aar&apos;)</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    repositories{</div><div class="line">        flatDir{</div><div class="line">            dirs &apos;E:\\myAar&apos;</div><div class="line">       }</div><div class="line">    }</div><div class="line">}</div><div class="line">//&#x5C06;&#x51FD;&#x6570;&#x8BBE;&#x7F6E;&#x4E3A;extra&#x5C5E;&#x6027;&#x4E2D;&#x53BB;&#xFF0C;&#x8FD9;&#x6837;&#xFF0C;&#x52A0;&#x8F7D;utils.gradle&#x7684;Project&#x5C31;&#x80FD;&#x8C03;&#x7528;&#x6B64;&#x6587;&#x4EF6;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x4E86;</div><div class="line">ext{</div><div class="line">    addExtendsDependencies = this.&amp;addExtendsDependencies</div><div class="line">    appName = &quot;&#x5929;&#x5929;&#x6597;&#x5730;&#x4E3B;&#x771F;&#x4EBA;&#x7248;&quot;</div><div class="line">}</div><div class="line"></div><div class="line">build.gradle</div><div class="line"></div><div class="line">apply from: rootProject.getRootDir().getAbsolutePath()+&quot;/gradle/${channelFlavors}Config.gradle&quot;</div><div class="line"></div><div class="line">dependencies {</div><div class="line">    compile fileTree(dir: &apos;libs&apos;, include: &apos;*.jar&apos;)</div><div class="line">    addExtendsDependencies()</div><div class="line">}</div></pre></td></tr></table></figure>
<h2 id="&#x81EA;&#x5B9A;&#x4E49;&#x6E20;&#x9053;&#x540D;&#x79F0;"><a href="#&#x81EA;&#x5B9A;&#x4E49;&#x6E20;&#x9053;&#x540D;&#x79F0;" class="headerlink" title="&#x81EA;&#x5B9A;&#x4E49;&#x6E20;&#x9053;&#x540D;&#x79F0;"></a>&#x81EA;&#x5B9A;&#x4E49;&#x6E20;&#x9053;&#x540D;&#x79F0;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">productFlavors{</div><div class="line">        &quot;${channelFlavors}&quot;{</div><div class="line">            applicationId packageName</div><div class="line">        }</div><div class="line">    }</div></pre></td></tr></table></figure>
<h2 id="xml&#x6DFB;&#x52A0;&#xFF0C;&#x5220;&#x9664;&#xFF0C;&#x66F4;&#x65B0;&#xFF0C;&#x67E5;&#x8BE2;"><a href="#xml&#x6DFB;&#x52A0;&#xFF0C;&#x5220;&#x9664;&#xFF0C;&#x66F4;&#x65B0;&#xFF0C;&#x67E5;&#x8BE2;" class="headerlink" title="xml&#x6DFB;&#x52A0;&#xFF0C;&#x5220;&#x9664;&#xFF0C;&#x66F4;&#x65B0;&#xFF0C;&#x67E5;&#x8BE2;"></a>xml&#x6DFB;&#x52A0;&#xFF0C;&#x5220;&#x9664;&#xFF0C;&#x66F4;&#x65B0;&#xFF0C;&#x67E5;&#x8BE2;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line">def void updateManifestXml(def path){</div><div class="line">    File file = new File(path)</div><div class="line"></div><div class="line">    def doc = DOMBuilder.parse(new StringReader(file.text))</div><div class="line">    def root = doc.documentElement</div><div class="line">    use(groovy.xml.dom.DOMCategory) {</div><div class="line">        //&#x79FB;&#x9664;&#x6389;&#x9ED8;&#x8BA4;&#x542F;&#x52A8;intent-filter &#x4EE5;&#x53CA; &#x57FA;&#x5730;&#x6807;&#x5FD7;&#x7684;intent-filter</div><div class="line">        removeIntentFilterByAction_Categroy(root,&quot;android.intent.action.MAIN&quot;,&quot;android.intent.category.LAUNCHER&quot;)</div><div class="line">        removeIntentFilterByAction_Categroy(root,&quot;android.intent.action.CHINAMOBILE_OMS_GAME&quot;,&quot;android.intent.category.CHINAMOBILE_GAMES&quot;)</div><div class="line"></div><div class="line"></div><div class="line">        // &#x6839;&#x636E;&#x4E0D;&#x540C;&#x542F;&#x52A8;Activity&#x6DFB;&#x52A0;&#x4E0D;&#x540C;&#x7684;&#x64CD;&#x4F5C;</div><div class="line">        if(hasLoginActivity){</div><div class="line">            // LoginAcitivity &#x95EA;&#x5C4F;&#x9875;&#x542F;&#x52A8;</div><div class="line">            // 1. &#x542F;&#x52A8;&#x9875;&#x6A2A;&#x7AD6;&#x5C4F;&#x8BBE;&#x7F6E;</div><div class="line">            // 2. &#x542F;&#x52A8;&#x9875;&#x4E3B;&#x9898;&#x8BBE;&#x7F6E;</div><div class="line">            //def androidMap = [&quot;android:screenOrientation&quot;:&quot;landscape&quot;,</div><div class="line">            //           &quot;android:theme&quot;:&quot;@style/GameTheme&quot;]</div><div class="line">            if(androidMap.size()&gt;0){</div><div class="line">                replaceActivityAttributes(root,androidMap)</div><div class="line">            }</div><div class="line">            // 3. LoginActivity &#x6DFB;&#x52A0;&#x542F;&#x52A8;&#x9879; &#x548C; &#x57FA;&#x5730;&#x6807;&#x5FD7;</div><div class="line">            addMainIntentFilter(root,&quot;com.zengame.basic.LoginActivity&quot;)</div><div class="line">            addAndGameIntentFilter(root,&quot;com.zengame.basic.LoginActivity&quot;)</div><div class="line">        }else{</div><div class="line">            // GameActivity &#x542F;&#x52A8;</div><div class="line">            // 1. &#x79FB;&#x9664;&#x6389;LoginActivity</div><div class="line">            removeActivityByName(root,&quot;com.zengame.basic.LoginActivity&quot;)</div><div class="line">            // 2. GameActivity &#x6DFB;&#x52A0;&#x542F;&#x52A8;&#x9879; &#x548C; &#x57FA;&#x5730;&#x6807;&#x5FD7;</div><div class="line">            addMainIntentFilter(root,&quot;com.zengame.basic.GameActivity&quot;)</div><div class="line">            addAndGameIntentFilter(root,&quot;com.zengame.basic.GameActivity&quot;)</div><div class="line">        }</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    def result = XmlUtil.serialize(root)</div><div class="line">    file.write(result,&quot;UTF-8&quot;)</div><div class="line">   // println result</div><div class="line">}</div><div class="line"></div><div class="line">def void addMainIntentFilter(def root,String name){</div><div class="line">    root.getElementsByTagName(&quot;activity&quot;).each {node -&gt;</div><div class="line">        if(node.attributes.getNamedItem(&quot;android:name&quot;).nodeValue==name){</div><div class="line">            org.w3c.dom.Element element = node.appendNode(&quot;intent-filter&quot;)</div><div class="line">            element.appendNode(&quot;action&quot;,[&quot;android:name&quot;:&quot;android.intent.action.MAIN&quot;])</div><div class="line">            element.appendNode(&quot;category&quot;,[&quot;android:name&quot;:&quot;android.intent.category.LAUNCHER&quot;])</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line">def void addAndGameIntentFilter(def root,String name){</div><div class="line">    root.getElementsByTagName(&quot;activity&quot;).each {node -&gt;</div><div class="line">        if(node.attributes.getNamedItem(&quot;android:name&quot;).nodeValue==name){</div><div class="line">            org.w3c.dom.Element element = node.appendNode(&quot;intent-filter&quot;)</div><div class="line">            element.appendNode(&quot;action&quot;,[&quot;android:name&quot;:&quot;android.intent.action.CHINAMOBILE_OMS_GAME&quot;])</div><div class="line">            element.appendNode(&quot;category&quot;,[&quot;android:name&quot;:&quot;android.intent.category.CHINAMOBILE_GAMES&quot;])</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line">def void removeActivityByName(def root,String name){</div><div class="line">    root.getElementsByTagName(&quot;activity&quot;).each {node -&gt;</div><div class="line">        if(node.attributes.getNamedItem(&quot;android:name&quot;).nodeValue==name){</div><div class="line">            node.parentNode.removeChild(node)</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line">def void replaceActivityAttributes(def root,def map){</div><div class="line">    root.getElementsByTagName(&quot;activity&quot;).each {node -&gt;</div><div class="line">        if(node.attributes.getNamedItem(&quot;android:name&quot;).nodeValue==&quot;com.zengame.basic.LoginActivity&quot;){</div><div class="line">            map.each {key,value -&gt;</div><div class="line">                node.attributes.getNamedItem(key).setNodeValue(value)</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line">def void removeIntentFilterByAction_Categroy(def root,String actionValue,String categroyValue){</div><div class="line">    root.getElementsByTagName(&quot;intent-filter&quot;).each {node -&gt;</div><div class="line">        boolean hasMain</div><div class="line">        boolean hasLuancher</div><div class="line">        node.childNodes.each { childNode -&gt;</div><div class="line">            if (childNode.nodeName == &quot;action&quot; &amp;&amp; actionValue == childNode.attributes.getNamedItem(&quot;android:name&quot;).nodeValue) {</div><div class="line">                hasMain = true</div><div class="line">            }</div><div class="line">            if (childNode.nodeName == &quot;category&quot; &amp;&amp; categroyValue == childNode.attributes.getNamedItem(&quot;android:name&quot;).nodeValue) {</div><div class="line">                hasLuancher = true</div><div class="line">            }</div><div class="line">        }</div><div class="line">        if (hasMain &amp;&amp; hasLuancher) {</div><div class="line">            node.parentNode.removeChild(node)</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>
<h2 id="&#x6DFB;&#x52A0;&#x58F0;&#x660E;&#x5468;&#x671F;hook&#xFF0C;&#x66FF;&#x6362;&#x6784;&#x5EFA;apk&#x4E2D;&#x8D44;&#x6E90;&#x6587;&#x4EF6;"><a href="#&#x6DFB;&#x52A0;&#x58F0;&#x660E;&#x5468;&#x671F;hook&#xFF0C;&#x66FF;&#x6362;&#x6784;&#x5EFA;apk&#x4E2D;&#x8D44;&#x6E90;&#x6587;&#x4EF6;" class="headerlink" title="&#x6DFB;&#x52A0;&#x58F0;&#x660E;&#x5468;&#x671F;hook&#xFF0C;&#x66FF;&#x6362;&#x6784;&#x5EFA;apk&#x4E2D;&#x8D44;&#x6E90;&#x6587;&#x4EF6;"></a>&#x6DFB;&#x52A0;&#x58F0;&#x660E;&#x5468;&#x671F;hook&#xFF0C;&#x66FF;&#x6362;&#x6784;&#x5EFA;apk&#x4E2D;&#x8D44;&#x6E90;&#x6587;&#x4EF6;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">project.tasks.whenTaskAdded { task -&gt;</div><div class="line">    if(task.name.contains(&apos;AndroidTest&apos;)){</div><div class="line">        task.enabled = false</div><div class="line">    }</div><div class="line">    android.applicationVariants.all{ variant -&gt;</div><div class="line">        if(task.name.contains(&quot;Debug&quot;)){</div><div class="line">            logger.log(LogLevel.INFO,&quot;Debug task&#x8FC7;&#x6EE4;${task.name}&quot;);</div><div class="line">        }else if(task.name==&quot;merge${variant.name.capitalize()}Assets&quot;){</div><div class="line">            logger.quiet(&quot;^^^^^^^^^^^^^^merge${variant.name.capitalize()}Assets&quot;)</div><div class="line">            task.doLast {</div><div class="line">                println &quot;cowboy &quot; +buildDir.absolutePath</div><div class="line">                String path =buildDir.absolutePath+&quot;\\intermediates\\assets\\&quot;+variant.name.capitalize()-&quot;Release&quot;+&quot;\\release&quot;</div><div class="line">                logger.quiet(&quot;^^^^^^^^^^^^^^${project.name} assemble projectDir ${project.projectDir.absolutePath}&quot;)</div><div class="line">                if(new File(path).exists()) {</div><div class="line">                    copyFile(&quot;${channelFlavors}_build_app.properties&quot;,&quot;build_app.properties&quot;,rootProject.getRootDir().getAbsolutePath()+&quot;/gradle&quot;, path)</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }else if(task.name==&quot;merge${variant.name.capitalize()}Resources&quot;){</div><div class="line">            logger.quiet(&quot;^^^^^^^^^^^^^^merge${variant.name.capitalize()}Resources&quot;)</div><div class="line">            task.doFirst {</div><div class="line">                String valuePath = projectDir.absolutePath+&quot;\\res\\values\\strings.xml&quot;</div><div class="line">                File valueFile =new File(valuePath);</div><div class="line">                if(valueFile.exists()){</div><div class="line">                    def text =valueFile.text.replaceAll(&quot;&lt;string name=\&quot;app_name\&quot;&gt;.*&lt;/string&gt;&quot;,&quot;&lt;string name=\&quot;app_name\&quot;&gt;&quot;+appName+&quot;&lt;/string&gt;&quot;)</div><div class="line">                    valueFile.write(text,&quot;UTF-8&quot;)</div><div class="line">                }</div><div class="line">            }</div><div class="line">//            task.doLast {</div><div class="line">//                String path = buildDir.absolutePath+&quot;\\intermediates\\res\\merged\\zenGame\\release\\drawable-xxhdpi-v4&quot;;</div><div class="line">//                logger.quiet(&quot;^^^^^^^^^^^^^^${project.name} assemble projectDir ${project.projectDir.absolutePath}&quot;)</div><div class="line">//                if (new File(path).exists()) {</div><div class="line">//                    copyFile(&quot;ic_launcher.png&quot;,&quot;ic_launcher.png&quot;,&quot;E:\\ssd&quot;, path)</div><div class="line">//                }</div><div class="line">//            }</div><div class="line">        }else if(task.name == &quot;process${variant.name.capitalize()}Manifest&quot;){</div><div class="line">            task.doLast {</div><div class="line">                String str = buildDir.absolutePath+&quot;\\intermediates\\manifests\\full\\&quot;+variant.name.capitalize()-&quot;Release&quot;+&quot;\\release\\AndroidManifest.xml&quot;</div><div class="line">                logger.quiet(&quot;^^^^^^^^^^^^^^${project.name} cowboy ${variant.name.capitalize()}Manifest&quot;)</div><div class="line">                File valueFile =new File(str)</div><div class="line">                if(valueFile.exists()){</div><div class="line">                    def text = valueFile.text;</div><div class="line">                    map.each {key,value -&gt;</div><div class="line">                        text =text.replaceAll(&quot;START_REPLACE_&quot;+key+&quot;_END_REPLACE&quot;,value)</div><div class="line">                    }</div><div class="line">                    valueFile.write(text,&quot;UTF-8&quot;)</div><div class="line"></div><div class="line">                    updateManifestXml(str)</div><div class="line">                    println &quot;cowboy to stop&quot;</div><div class="line">//                    throw new GradleException(&quot;cowboy to stop &quot;)</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line"></div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure></div><div class="tags"><a href="/tags/gradle/">gradle</a><a href="/tags/groovy/">groovy</a></div><div class="post-share"></div><div class="post-nav"><a href="/2016/09/13/theme-next内嵌标签/" class="pre">theme-next内嵌标签</a><a href="/2016/03/25/2016书籍清单/" class="next">2016书籍清单</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一、gradle工作流"><span class="toc-text">一、gradle工作流</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#读取manifest中versionName"><span class="toc-text">读取manifest中versionName</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#为所有子工程添加公共方法"><span class="toc-text">为所有子工程添加公共方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#将依赖扩展和参数抽离到新的脚本"><span class="toc-text">将依赖扩展和参数抽离到新的脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义渠道名称"><span class="toc-text">自定义渠道名称</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xml添加，删除，更新，查询"><span class="toc-text">xml添加，删除，更新，查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#添加声明周期hook，替换构建apk中资源文件"><span class="toc-text">添加声明周期hook，替换构建apk中资源文件</span></a></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/C语言/">C语言</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Gradle/">Gradle</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/maven/">maven</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/偷得浮生半日闲/">偷得浮生半日闲</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/学习/">学习</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/学习必备/">学习必备</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/10/28/学习必备/">学习必备</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/08/C标准库概述/">C标准库概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/17/android学习/">android学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/12/2d绘图/">2d绘图</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/30/sublime-使用记录/">sublime 使用记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/28/shadowsocks代理/">shadowsocks代理</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/13/theme-next内嵌标签/">theme-next内嵌标签</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/04/gradle-学习心得/">gradle学习心得，记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/25/2016书籍清单/">2016书籍清单</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/23/生活-不慢不快/">生活 - 不慢不快</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/gradle/" style="font-size: 15px;">gradle</a> <a href="/tags/阅读/" style="font-size: 15px;">阅读</a> <a href="/tags/android/" style="font-size: 15px;">android</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/C/" style="font-size: 15px;">C</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/命令/" style="font-size: 15px;">命令</a> <a href="/tags/学习/" style="font-size: 15px;">学习</a> <a href="/tags/groovy/" style="font-size: 15px;">groovy</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/shadowsocks/" style="font-size: 15px;">shadowsocks</a> <a href="/tags/sublime/" style="font-size: 15px;">sublime</a> <a href="/tags/感悟/" style="font-size: 15px;">感悟</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p><span> Copyright &copy;<a href="/." rel="nofollow">whhqhy.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script type="text/javascript" src="/js/search.json.js?v=2"></script><script type="text/javascript" src="/js/toctotop.js?v=2" async></script></body></html>